record(bo, "$(P)DISABLE"){
    field(DESC, "Disable comms")
    field(PINI, "YES")
    field(VAL, "$(DISABLE=0)")
    field(OMSL, "supervisory")
    field(ZNAM, "COMMS ENABLED")
    field(ONAM, "COMMS DISABLED")
}

record(bo, "$(P)SIM"){
    field(DESC, "Recsim mode")
    field(PINI, "YES")
    field(VAL, "$(RECSIM=0)")
    field(OMSL, "supervisory")
    field(ZNAM, "Normal")
    field(ONAM, "Recsim")
}

record(ao, "$(P)VOLT:FULLSCALE") {
    field(VAL, "$(VOLT_FULLSCALE)")
    field(PINI, "YES")
}

record(ao, "$(P)CURR:FULLSCALE") {
    field(VAL, "$(CURR_FULLSCALE)")
    field(PINI, "YES")
}

record(bo, "$(P)POWER:SP") {
    field(ZNAM, "OFF")
    field(ONAM, "ON")
    field(DTYP, "stream")
    field(OUT, "@transtechnik.proto power($(PS_ADDR)) $(PORT)")
}

record(bi, "$(P)POWER") {
    field(ZNAM, "OFF")
    field(ONAM, "ON")
	field(INP, "$(P)STATUS.B0 CP MSS")
	info(interest, "HIGH")
}

record(bo, "$(P)RESET") {
    field(ZNAM, "OFF")
    field(ONAM, "ON")
    field(DTYP, "stream")
    field(OUT, "@transtechnik.proto reset($(PS_ADDR)) $(PORT)")
}
alias("$(P)RESET", "$(P)RESET:SP")

record(longin, "$(P)VOLT:RAW") {
    field(DTYP, "stream")
    field(SCAN, "1 second")
    field(INP, "@transtechnik.proto get_ad($(PS_ADDR), 1) $(PORT)")
    field(EGU, "ppm")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:VOLT:RAW")
    field(SDIS, "$(P)DISABLE")
}

record(calc, "$(P)VOLT") {
    field(INPA, "$(P)VOLT:RAW CP MSS")
    field(INPB, "$(P)VOLT:FULLSCALE CP MSS")
    field(CALC, "(A/1000000)*B")
    field(ASG, "READONLY")
    field(EGU, "V")
	field(PREC, "3")
    info(interest, "HIGH")
}

record(ao, "$(P)VOLT:SP") {
    field(EGU, "V")
	field(PREC, "3")
    field(FLNK, "$(P)VOLT:SP:_CALC")
}

record(calcout, "$(P)VOLT:SP:_CALC") {
    field(INPA, "$(P)VOLT:SP")
    field(INPB, "$(P)VOLT:FULLSCALE")
    field(CALC, "(A/B)*1000000")
    field(OUT, "$(P)VOLT:SP:_RAW PP")
}

record(longout, "$(P)VOLT:SP:_RAW") {
    field(DTYP, "stream")
    field(OUT, "@transtechnik.proto set_da($(PS_ADDR), 1) $(PORT)")
    field(EGU, "ppm")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:VOLT:RAW")
    field(SDIS, "$(P)DISABLE")
}

record(longin, "$(P)CURR:RAW") {
    field(DTYP, "stream")
    field(SCAN, "1 second")
    field(INP, "@transtechnik.proto get_ad($(PS_ADDR), 0) $(PORT)")
    field(EGU, "ppm")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:CURR:RAW")
    field(SDIS, "$(P)DISABLE")
}

record(calc, "$(P)CURR") {
    field(INPA, "$(P)CURR:RAW CP MSS")
    field(INPB, "$(P)CURR:FULLSCALE CP MSS")
    field(CALC, "(A/1000000)*B")
    field(ASG, "READONLY")
    field(EGU, "A")
	field(PREC, "3")
    info(interest, "HIGH")
}

record(ao, "$(P)CURR:SP") {
    field(EGU, "A")
	field(PREC, "3")
    field(FLNK, "$(P)CURR:SP:_CALC")
}

record(calcout, "$(P)CURR:SP:_CALC") {
    field(INPA, "$(P)CURR:SP")
    field(INPB, "$(P)CURR:FULLSCALE")
    field(CALC, "(A/B)*1000000")
    field(OUT, "$(P)CURR:SP:_RAW PP")
}

record(longout, "$(P)CURR:SP:_RAW") {
    field(DTYP, "stream")
    field(OUT, "@transtechnik.proto set_da($(PS_ADDR), 0) $(PORT)")
    field(EGU, "ppm")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:CURR:RAW")
    field(SDIS, "$(P)DISABLE")
}


record(mbbiDirect, "$(P)STATUS") {
    field(SCAN, "1 second")
	field(DTYP, "stream")
	field(INP, "@transtechnik.proto get_stat($(PS_ADDR)) $(PORT)")
	# BF = ?
	# BE = ?
	# BD = ?
	# BC = ?
	# BB = ?
	# BA = ?
	# B9 = ?
	# B8 = ?
	# B7 = ?
	# B6 = ?
	# B5 = ?
	# B4 = ?
	# B3 = ?
	# B2 = ?
	# B1 = ?
	# B0 = ?
}

record(bi, "$(P)INTERLOCK") {
    field(ZNAM, "Inactive")
    field(ONAM, "Active")
	field(INP, "$(P)STATUS.B1 CP MSS")
	info(interest, "HIGH")
}


#
# Simulation records
#

record(ao, "$(P)SIM:VOLT:RAW") {}
record(ao, "$(P)SIM:CURR:RAW") {}
